<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-19RP0D764T"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-19RP0D764T');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Wallpaper Cup ‚Äì puzzle + vote</title>
    <!-- SEO + fonts -->
    <meta name="description" content="Daily wallpaper battle: 4 fresh AI images. Vote, download, play puzzle. New winner midnight UTC.">
    <meta name="keywords" content="daily wallpaper, vote wallpaper, download AI art, wallpaper ranking, daily cup, top wallpaper today, 4k free, daily challenge, wallpaper puzzle">
    <meta name="author" content="wallrank.club">
    <link rel="canonical" href="https://wallrank.club">
    <meta property="og:title" content="Daily Wallpaper Cup ‚Äì 4 images, one winner + puzzle">
    <meta property="og:description" content="Every day: 4 fresh AI wallpapers. Vote, download, play puzzle. At midnight UTC the winner is crowned.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wallrank.club">
    <meta property="og:image" content="https://wallrank.club/og-daily.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ---------- YOUR EXACT COZY DESIGN (100% preserved) ---------- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Quicksand', sans-serif;
            background: #fffaf2; color: #3a2c2a; padding: 24px 20px;
            line-height: 1.5; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        .container { max-width: 1200px; width: 100%; }
        .top-bar {
            display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between;
            background: #ffe8d9; padding: 16px 24px; border-radius: 80px; margin-bottom: 40px;
            box-shadow: 0 6px 0 #ffb08c; border: 2px solid #ff9f7c;
        }
        .whats-this-btn {
            background: #ff7b5c; border: none; color: white; font-weight: 700; font-size: 1.1rem;
            padding: 10px 22px; border-radius: 50px; cursor: pointer; display: flex; align-items: center;
            gap: 10px; box-shadow: 0 5px 0 #c53f2b; transition: 0.08s linear; border: 2px solid white;
            letter-spacing: 0.5px;
        }
        .whats-this-btn:active { transform: translateY(5px); box-shadow: 0 1px 0 #c53f2b; }
        .countdown-block {
            background: white; padding: 8px 24px; border-radius: 50px; font-weight: 600;
            display: flex; align-items: center; gap: 10px; border: 2px dashed #ff7b5c;
        }
        .countdown-number {
            background: #2e1f1c; color: #fff5e6; padding: 8px 14px; border-radius: 40px; font-size: 1.5rem;
            font-weight: 700; font-variant-numeric: tabular-nums; box-shadow: inset 0 -2px 0 #5a3f39;
        }
        .winner-note { font-size: 0.95rem; color: #6b4b3e; font-weight: 600; }
        .daily-headline { text-align: center; margin-bottom: 20px; }
        .daily-headline h2 { font-size: 2rem; font-weight: 700; color: #402b24; letter-spacing: -0.5px; }
        .daily-headline p {
            font-size: 1.2rem; background: #fff0e5; display: inline-block; padding: 6px 26px;
            border-radius: 50px; color: #a84c3a; font-weight: 600; margin-top: 8px;
        }
        .wallpaper-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 22px; margin: 40px 0 30px;
        }
        .wall-card {
            background: white; border-radius: 32px; overflow: hidden; border: 4px solid #ffd8bf;
            box-shadow: 0 12px 0 #d6957b, 0 8px 20px rgba(0,0,0,0.08); transition: all 0.1s ease;
            display: flex; flex-direction: column; position: relative;
        }
        .wall-card:hover {
            transform: translateY(-4px); box-shadow: 0 14px 0 #b37b66, 0 12px 28px rgba(0,0,0,0.12);
            border-color: #ffb08c;
        }
        .wall-card.leader-gold {
            border: 4px solid #ffd700; box-shadow: 0 12px 0 #b8860b, 0 0 20px rgba(255, 215, 0, 0.6);
            animation: softShimmer 2s infinite alternate;
        }
        @keyframes softShimmer {
            from { box-shadow: 0 12px 0 #b8860b, 0 0 15px #ffd700; }
            to { box-shadow: 0 12px 0 #9b7e1e, 0 0 30px #ffea80; }
        }
        .wall-card.leader-gold .img-container::after {
            content: "üëë"; position: absolute; top: 10px; right: 15px; font-size: 2.8rem;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2); z-index: 2;
        }
        .img-container { width: 100%; aspect-ratio: 4 / 5; background: #ffe3d6; position: relative; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .card-content { padding: 18px 14px 20px; background: white; display: flex; flex-direction: column; gap: 14px; }
        .wall-title { font-weight: 700; font-size: 1.25rem; color: #4e3a33; display: flex; align-items: center; gap: 6px; }
        .stats {
            display: flex; justify-content: space-between; color: #8a6a5b; font-weight: 600; font-size: 1rem;
            background: #fceded; padding: 10px 12px; border-radius: 40px; border: 1px solid #ffc6ad;
        }
        .button-group { display: flex; gap: 10px; margin-top: 6px; }
        .btn {
            flex: 1; border: none; background: #fbe9e7; border-radius: 60px; padding: 14px 0;
            font-weight: 700; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;
            gap: 8px; color: #3b2c28; border: 3px solid #ffc6a2; box-shadow: 0 5px 0 #d28b70;
            transition: 0.06s linear; cursor: pointer; letter-spacing: 1px;
        }
        .btn:active { transform: translateY(5px); box-shadow: 0 1px 0 #b16d56; }
        .btn-vote { background: #ffdbb5; border-color: #ffa558; color: #441f17; }
        .btn-download { background: #c7e9d0; border-color: #6eb5a4; color: #1e4a44; box-shadow: 0 5px 0 #518b7e; }
        .btn-vote.clicked { background: #ffb485; border-color: #ff6b4a; color: white; box-shadow: 0 5px 0 #c5452a; }
        .btn-download.clicked { background: #92cfb6; border-color: #237a6b; color: white; box-shadow: 0 5px 0 #1d5f53; }
        .reaction-emoji {
            font-size: 2.5rem; position: absolute; pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 999;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(0.8); }
            100% { opacity: 0; transform: translateY(-70px) scale(1.5); }
        }
        .footer-links {
            margin-top: 70px; padding: 40px 20px 30px; border-top: 3px solid #ffc6ad;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 32px; font-size: 0.9rem;
            background: #fff8f2; border-radius: 40px 40px 0 0; width: 100%;
        }
        .footer-links a { text-decoration: none; color: #65433b; font-weight: 600; border-bottom: 2px dotted #ffa777; }
        .footer-links a:hover { color: #c14325; }
        .copyright { width: 100%; text-align: center; color: #8c6c62; margin-top: 24px; font-size: 0.85rem; }
        @media (max-width: 900px) {
            .wallpaper-grid { grid-template-columns: repeat(2, 1fr); }
            .top-bar { flex-direction: column; gap: 15px; align-items: stretch; }
        }
        @media (max-width: 550px) { .wallpaper-grid { grid-template-columns: 1fr; } }
        .seo-hidden { position: absolute; left: -9999px; top: -9999px; height: 1px; width: 1px; overflow: hidden; }
        .info-popup {
            display: none; background: white; border: 5px solid #ffb08c; border-radius: 32px; padding: 28px;
            max-width: 450px; box-shadow: 0 20px 0 #a8624b; margin: 20px auto;
        }
        .info-popup.show { display: block; }
        .close-popup { float: right; font-size: 2rem; background: none; border: none; cursor: pointer; color: #a8624b; }
        .winner-badge { background: #ffdbb5; padding: 6px 12px; border-radius: 30px; font-size: 0.8rem; font-weight: 700; }

        /* ---------- PUZZLE BUTTON (cute & bouncy) ---------- */
        .puzzle-launch {
            display: flex; justify-content: center; margin: 30px 0 20px;
        }
        .puzzle-btn {
            background: #ffd0b5; border: 4px solid #fff; color: #593c34; font-size: 1.4rem;
            font-weight: 700; padding: 16px 36px; border-radius: 120px; box-shadow: 0 10px 0 #c47a5e;
            display: flex; align-items: center; gap: 16px; transition: 0.06s; cursor: pointer;
            border: 3px solid #ffe3d6; letter-spacing: 2px;
        }
        .puzzle-btn:active { transform: translateY(8px); box-shadow: 0 2px 0 #a05e46; }
        .puzzle-btn span { font-size: 2rem; }

        /* ---------- PUZZLE OVERLAY ‚Äì FIXED! EASY TO SOLVE! ---------- */
        .puzzle-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(6px); z-index: 2000;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        .puzzle-overlay.active { display: flex; }
        .puzzle-card {
            background: #fff9f0; border-radius: 64px 64px 48px 48px; padding: 30px;
            max-width: 750px; width: 90%; border: 6px solid #ffc6ad; box-shadow: 0 18px 0 #a8624b;
            text-align: center; position: relative;
        }
        .puzzle-title { font-size: 2rem; font-weight: 700; color: #402b24; margin-bottom: 10px; }
        .puzzle-selector {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 25px 0;
        }
        .puzzle-thumb {
            width: 100px; height: 100px; border-radius: 24px; border: 5px solid #ffd8bf;
            box-shadow: 0 6px 0 #b37b66; cursor: pointer; transition: 0.1s;
        }
        .puzzle-thumb:hover { transform: scale(1.05); border-color: #ffa07a; }
        .puzzle-thumb img { width: 100%; height: 100%; object-fit: cover; border-radius: 18px; }

        /* üü¢üü¢üü¢ FIXED PUZZLE GRID ‚Äì EACH PIECE SHOWS DIFFERENT PART! üü¢üü¢üü¢ */
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            width: 360px;
            height: 360px;
            margin: 20px auto;
            background: #ffe8dd;
            padding: 2px;
            border: 4px solid #ffad8a;
            box-shadow: 0 10px 0 #b37b66;
            border-radius: 8px;
        }
        
        .puzzle-piece {
            width: 100%;
            height: 100%;
            background-color: #ffe3d6;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: 360px 360px;
            background-repeat: no-repeat;
            cursor: grab;
            transition: 0.05s;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
        }
        .puzzle-piece:active { cursor: grabbing; }

        /* üéâüéâüéâ AMAZING VICTORY CELEBRATION ‚Äì ALIVE & JOYFUL üéâüéâüéâ */
        .celebration-8s {
            background: linear-gradient(145deg, #ffeaa5, #ffd48a);
            padding: 30px 20px;
            border-radius: 80px;
            font-size: 2.5rem;
            margin: 20px 0;
            border: 8px solid #fff1b5;
            animation: bounce 0.8s infinite alternate, partyGlow 1.5s infinite alternate;
            position: relative;
            box-shadow: 0 0 30px #ffb347;
            font-weight: 800;
            letter-spacing: 4px;
        }
        @keyframes bounce {
            from { transform: scale(1); }
            to   { transform: scale(1.08); }
        }
        @keyframes partyGlow {
            from { box-shadow: 0 0 20px #ffae42, 0 0 40px #ff8c00; }
            to   { box-shadow: 0 0 40px #ffd700, 0 0 80px #ffaa33; }
        }
        /* floating confetti ‚Äì pure css fun */
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ffb3c6;
            opacity: 0.8;
            animation: fall 3s linear infinite;
            border-radius: 2px;
        }
        @keyframes fall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(200px) rotate(360deg); opacity: 0; }
        }

        /* ---------- ALL BUTTONS ‚Äì DELIGHTFUL PRESS & HOVER ---------- */
        .btn-small, .social-icon, .puzzle-btn, .whats-this-btn {
            transition: all 0.08s ease;
        }
        .btn-small:active, .social-icon:active, .close-popup:active {
            transform: translateY(5px) !important;
            box-shadow: 0 1px 0 #b37b66 !important;
        }
        .btn-small:hover, .social-icon:hover, .puzzle-thumb:hover {
            transform: scale(1.02);
        }
        .close-popup {
            transition: 0.08s;
        }
        /* signature input ‚Äì joyful focus */
        .signature-input:focus {
            border-color: #ff7b5c;
            box-shadow: 0 0 0 4px #ffe0d4;
            outline: none;
        }

        .signature-input {
            border: 4px dashed #ffad8a; border-radius: 60px; padding: 12px 24px;
            font-size: 1.2rem; width: 80%; margin: 15px 0; text-align: center;
            font-family: 'Quicksand', cursive;
        }
        .social-icons {
            display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin: 25px 0 10px;
        }
        .social-icon {
            background: #ffdcc2; padding: 12px; border-radius: 50%; font-size: 1.8rem; width: 64px; height: 64px;
            display: flex; align-items: center; justify-content: center; border: 3px solid white;
            box-shadow: 0 5px 0 #c47a5e; cursor: pointer;
        }
        .social-icon:active { transform: translateY(5px); box-shadow: 0 1px 0 #9b5e4a; }
        .btn-small {
            background: #ffe0b5; padding: 12px 24px; border-radius: 50px; border: 3px solid #ffad8a;
            font-weight: 700; margin: 8px; box-shadow: 0 4px 0 #b37b66; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- top bar unchanged -->
        <div class="top-bar">
            <button class="whats-this-btn" id="infoButton"><span style="font-size:1.6rem;">‚ú®</span> What's this?</button>
            <div class="countdown-block">
                <span class="winner-note">üèÜ Winner in</span>
                <span class="countdown-number" id="countdownDisplay">00:00:00</span>
                <span style="background: #ffc6ad; padding: 5px 12px; border-radius: 30px;">UTC+0</span>
            </div>
        </div>
        <div id="infoPopup" class="info-popup">
            <button class="close-popup" id="closePopup">&times;</button>
            <h3 style="font-size:2rem; margin-bottom: 10px;">üå∏ daily cup</h3>
            <p style="font-size:1.2rem; font-weight: 600;">4 wallpapers. 1 winner. you decide.</p>
            <p style="margin: 20px 0;">‚¨© Vote ‚Äì feel the love ‚ù§Ô∏è<br>‚¨© Download free<br>‚¨© At midnight UTC most votes+downloads = WINNER.<br>‚¨© Fresh batch every day ‚ú®</p>
            <p style="background: #ffe1d4; padding: 14px; border-radius: 18px; font-size: 1.1rem;">
            üëë <strong>Come back EVERY DAY!</strong> New wallpapers, new winner.<br>‚≠ê Your vote shapes the cup.<br>üìÖ Fresh art awaits 24/7.
            </p>
        </div>
        <div class="daily-headline">
            <h2>üê£ today's wallpapers</h2>
            <p>vote + download = happy</p>
        </div>
        <!-- 4 WALLPAPER GRID -->
        <div class="wallpaper-grid" id="wallGrid"></div>
        
        <!-- CUTE PUZZLE BUTTON -->
        <div class="puzzle-launch">
            <div class="puzzle-btn" id="openPuzzleBtn">
                <span>üß©</span> play puzzle
            </div>
        </div>

        <div style="display: flex; justify-content: center; margin-top: 15px;">
            <span class="winner-badge">üåü golden shine = current leader</span>
        </div>
        
        <!-- ========== FOOTER ‚Äì LINKS NOW PROPERLY FILLED ========== -->
        <div class="footer-links">
            <a href="/about">About</a>
            <a href="/privacy">Privacy Policy</a>
            <a href="/terms">Terms of Service</a>
            <a href="/cookies">Cookie Settings</a>
            <a href="/ad-choices">Ad Choices</a>
            <a href="mailto:kabanijames9@gmail.com">Contact</a>
            <a href="/">Wallrank.club</a>
            <div class="copyright">
                ¬© 2026 WallRank.club ‚Äì Daily AI wallpaper cup. All rights reserved.<br>
                This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.
            </div>
        </div>
    </div>

    <!-- ========== PUZZLE OVERLAY ‚Äì COMPLETELY FIXED ========== -->
    <div id="puzzleOverlay" class="puzzle-overlay">
        <div class="puzzle-card" id="puzzleCard">
            <!-- Step 1: choose wallpaper -->
            <div id="step1">
                <div class="puzzle-title">üß© choose one</div>
                <div class="puzzle-selector" id="puzzleSelector"></div>
            </div>
            <!-- Step 2: puzzle grid ‚Äì FIXED! Each piece shows correct slice -->
            <div id="step2" style="display: none;">
                <div class="puzzle-title" id="selectedTitle">üåø misty forest</div>
                <div id="puzzleGridContainer" class="puzzle-grid"></div>
                <button class="btn-small" id="shuffleBtn" style="margin-top: 20px;">üîÄ shuffle</button>
            </div>
            <!-- Step 3: celebration & two buttons (CLOSE BUTTON HIDDEN during 8s) -->
            <div id="step3" style="display: none;">
                <div class="celebration-8s" id="celebrationMessage">üéâ‚ú® PERFECT! ‚ú®üéâ</div>
                <div id="afterCelebration" style="display: none;">
                    <button class="btn-small" id="saveMemoryBtn">üì∏ save this memory</button>
                    <button class="btn-small" id="tellOthersBtn">üì¢ tell others</button>
                </div>
            </div>
            <!-- Save memory options -->
            <div id="saveOptions" style="display: none;">
                <div style="font-size:1.6rem; margin: 15px 0;">üíæ save as</div>
                <button class="btn-small" id="saveWithNameBtn">üñãÔ∏è with your name</button>
                <button class="btn-small" id="saveSimpleBtn">‚¨áÔ∏è simple download</button>
                <div id="nameInputArea" style="display: none; margin-top: 20px;">
                    <input type="text" id="userName" placeholder="your name" class="signature-input">
                    <button class="btn-small" id="generateSignedWallpaper">create & download</button>
                </div>
                <canvas id="signatureCanvas" style="display: none;"></canvas>
            </div>
            <!-- Tell others popup -->
            <div id="shareOptions" style="display: none;">
                <div style="font-size:1.6rem; margin-bottom: 20px;">üîó share this puzzle</div>
                <div style="background: #ffe8dd; padding: 12px; border-radius: 60px; word-break: break-all;">
                    <span id="shareLink">https://wallrank.club/puzzle/winner</span>
                </div>
                <div class="social-icons">
                    <div class="social-icon" data-share="fb">üìò</div>
                    <div class="social-icon" data-share="ig">üì∑</div>
                    <div class="social-icon" data-share="pin">üìå</div>
                    <div class="social-icon" data-share="tw">üê¶</div>
                    <div class="social-icon" data-share="snap">üëª</div>
                    <div class="social-icon" data-share="email">üìß</div>
                </div>
                <button class="btn-small" id="closeShareBtn">‚¨Ö back</button>
            </div>
            <!-- CLOSE BUTTON ‚Äì hidden during victory celebration -->
            <button class="btn-small" id="closePuzzleBtn" style="margin-top: 25px;">‚úï close</button>
        </div>
    </div>

    <!-- hidden seo -->
    <div class="seo-hidden">daily wallpaper vote 4K free AI winner every midnight UTC+0 wallrank.club best ranking wallpaper puzzle</div>

    <script>
        (function() {
            'use strict';
            // ----- WALLPAPER DATA (4 images) -----
            const wallpapers = [
                { id: 1, title: "üåø misty forest", filename: "https://images.pexels.com/photos/1323550/pexels-photo-1323550.jpeg?auto=compress&cs=tinysrgb&w=600&h=750&fit=crop", votes: 0, downloads: 0 },
                { id: 2, title: "üçä citrus wave", filename: "https://images.pexels.com/photos/3104525/pexels-photo-3104525.jpeg?auto=compress&cs=tinysrgb&w=600&h=750&fit=crop", votes: 0, downloads: 0 },
                { id: 3, title: "üßä arctic dream", filename: "https://images.pexels.com/photos/360912/pexels-photo-360912.jpeg?auto=compress&cs=tinysrgb&w=600&h=750&fit=crop", votes: 0, downloads: 0 },
                { id: 4, title: "üå∏ pink cloud", filename: "https://images.pexels.com/photos/697662/pexels-photo-697662.jpeg?auto=compress&cs=tinysrgb&w=600&h=750&fit=crop", votes: 0, downloads: 0 }
            ];
            
            // ----- voting & golden leader (unchanged) -----
            function getTodayKey() { const d = new Date(); return `${d.getUTCFullYear()}-${d.getUTCMonth()}-${d.getUTCDate()}`; }
            const todayKey = getTodayKey(); let userVoteRecord = {};
            function loadVoteRecord() { const stored = localStorage.getItem(`voteRecord_${todayKey}`); if (stored) { try { userVoteRecord = JSON.parse(stored) || {}; } catch(e) { userVoteRecord = {}; } } else { userVoteRecord = {}; } }
            function saveVoteRecord() { localStorage.setItem(`voteRecord_${todayKey}`, JSON.stringify(userVoteRecord)); }
            loadVoteRecord();
            wallpapers.forEach(w => { let saved = localStorage.getItem(`dailyWall_${w.id}`); if (saved) { try { saved = JSON.parse(saved); w.votes = saved.votes || 0; w.downloads = saved.downloads || 0; } catch(e) {} } });
            
            const grid = document.getElementById('wallGrid');
            function renderCards() {
                grid.innerHTML = '';
                wallpapers.forEach((wp, index) => {
                    const card = document.createElement('div'); card.className = 'wall-card'; card.dataset.id = wp.id;
                    const imgHTML = `<div class="img-container"><img src="${wp.filename}" alt="${wp.title}" loading="lazy" onerror="this.src='https://placekitten.com/400/500?${wp.id}'"></div>`;
                    const stats = `<div class="stats"><span>‚ù§Ô∏è ${wp.votes}</span><span>‚¨áÔ∏è ${wp.downloads}</span></div>`;
                    const buttons = `<div class="button-group"><button class="btn btn-vote" data-action="vote" data-id="${wp.id}">üëç vote</button><button class="btn btn-download" data-action="download" data-id="${wp.id}">üíæ get</button></div>`;
                    card.innerHTML = imgHTML + `<div class="card-content"><div class="wall-title">${wp.title}</div>${stats}${buttons}</div>`;
                    grid.appendChild(card);
                });
                updateGoldenLeader();
            }
            function calculateLeaderId() { let leaderId = null; let maxScore = -1; wallpapers.forEach(w => { const score = w.votes + w.downloads; if (score > maxScore) { maxScore = score; leaderId = w.id; } }); return leaderId; }
            function updateGoldenLeader() { document.querySelectorAll('.wall-card').forEach(c => c.classList.remove('leader-gold')); const leaderId = calculateLeaderId(); if (leaderId !== null) { const leaderCard = document.querySelector(`.wall-card[data-id="${leaderId}"]`); if (leaderCard) leaderCard.classList.add('leader-gold'); } }
            
            // ----- REACTION: FLOATING EMOJIS (makes every button feel amazing) -----
            function createReaction(x, y, emoji = '‚ù§Ô∏è') {
                const reaction = document.createElement('div');
                reaction.className = 'reaction-emoji';
                reaction.textContent = emoji;
                reaction.style.left = (x - 30) + 'px';
                reaction.style.top = (y - 40) + 'px';
                document.body.appendChild(reaction);
                setTimeout(() => reaction.remove(), 800);
            }

            // ----- ADD CONFETTI TO CELEBRATION (extra joy) -----
            function addConfetti() {
                for (let i = 0; i < 30; i++) {
                    const conf = document.createElement('div');
                    conf.className = 'confetti';
                    conf.style.left = Math.random() * 100 + '%';
                    conf.style.animationDelay = Math.random() * 2 + 's';
                    conf.style.background = `hsl(${Math.random() * 360}, 80%, 70%)`;
                    conf.style.width = Math.random() * 12 + 6 + 'px';
                    conf.style.height = conf.style.width;
                    document.querySelector('.celebration-8s').appendChild(conf);
                    setTimeout(() => conf.remove(), 3000);
                }
            }
            
            function handleVote(id, event) {
                const wp = wallpapers.find(w => w.id === id); if (!wp) return;
                if (userVoteRecord[id] === true) {
                    const btn = document.querySelector(`.wall-card[data-id="${id}"] .btn-vote`);
                    if (btn) { btn.classList.add('clicked'); btn.innerHTML = '‚ö†Ô∏è already voted'; setTimeout(() => { btn.classList.remove('clicked'); btn.innerHTML = 'üëç vote'; }, 1200); }
                    if (event) createReaction(event.clientX, event.clientY, '‚è≥'); return;
                }
                wp.votes += 1; localStorage.setItem(`dailyWall_${id}`, JSON.stringify({ votes: wp.votes, downloads: wp.downloads }));
                userVoteRecord[id] = true; saveVoteRecord();
                const card = document.querySelector(`.wall-card[data-id="${id}"]`);
                if (card) { const statsSpan = card.querySelector('.stats'); if (statsSpan) statsSpan.innerHTML = `<span>‚ù§Ô∏è ${wp.votes}</span><span>‚¨áÔ∏è ${wp.downloads}</span>`;
                const btn = card.querySelector('.btn-vote'); if (btn) { btn.classList.add('clicked'); btn.innerHTML = '‚úì voted!'; setTimeout(() => { btn.classList.remove('clicked'); btn.innerHTML = 'üëç vote'; }, 1000); } }
                gtag('event', 'vote_cast', { 'event_category': 'engagement', 'event_label': wp.title, 'value': wp.votes });
                if (event) { 
                    createReaction(event.clientX, event.clientY, '‚ù§Ô∏èüî•'); 
                    createReaction(event.clientX-20, event.clientY-10, '‚ú®');
                    createReaction(event.clientX+20, event.clientY-5, '‚≠ê');
                }
                updateGoldenLeader();
            }
            function handleDownload(id, event) {
                const wp = wallpapers.find(w => w.id === id); if (!wp) return;
                wp.downloads += 1; localStorage.setItem(`dailyWall_${id}`, JSON.stringify({ votes: wp.votes, downloads: wp.downloads }));
                const card = document.querySelector(`.wall-card[data-id="${id}"]`);
                if (card) { const statsSpan = card.querySelector('.stats'); if (statsSpan) statsSpan.innerHTML = `<span>‚ù§Ô∏è ${wp.votes}</span><span>‚¨áÔ∏è ${wp.downloads}</span>`;
                const btn = card.querySelector('.btn-download'); if (btn) { btn.classList.add('clicked'); btn.innerHTML = '‚úì saved!'; setTimeout(() => { btn.classList.remove('clicked'); btn.innerHTML = 'üíæ get'; }, 1200); } }
                const link = document.createElement('a'); link.href = wp.filename; link.target = '_blank'; link.rel = 'noopener'; link.click();
                gtag('event', 'download_wall', { 'event_category': 'download', 'event_label': wp.title });
                if (event) { 
                    createReaction(event.clientX, event.clientY, 'üíæ‚ú®'); 
                    createReaction(event.clientX+15, event.clientY-15, '‚≠ê');
                    createReaction(event.clientX-15, event.clientY-10, 'üì•');
                }
                updateGoldenLeader();
            }
            document.addEventListener('click', function(e) {
                const btn = e.target.closest('.btn');
                if (!btn) return;
                const action = btn.dataset.action; const id = btn.dataset.id ? parseInt(btn.dataset.id) : null;
                if (!id) return;
                if (action === 'vote') { e.preventDefault(); handleVote(id, e); }
                else if (action === 'download') { e.preventDefault(); handleDownload(id, e); }
            });
            renderCards();
            
            // countdown
            function updateCountdown() {
                const now = new Date(); const utcNow = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds()));
                const nextMidnight = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1, 0, 0, 0));
                const diff = nextMidnight - utcNow;
                if (diff <= 0) { document.getElementById('countdownDisplay').innerText = '00:00:00'; return; }
                const hours = Math.floor(diff / 1000 / 60 / 60); const minutes = Math.floor((diff / 1000 / 60) % 60); const seconds = Math.floor((diff / 1000) % 60);
                document.getElementById('countdownDisplay').innerText = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            }
            updateCountdown(); setInterval(updateCountdown,1000);
            
            const infoBtn = document.getElementById('infoButton'); const popup = document.getElementById('infoPopup'); const closePopup = document.getElementById('closePopup');
            infoBtn.addEventListener('click',function(e){ 
                popup.classList.add('show'); 
                createReaction(e.clientX, e.clientY, '‚ú®');
                gtag('event','info_click',{'event_category':'engagement'}); 
            });
            closePopup.addEventListener('click',function(e){ 
                popup.classList.remove('show');
                createReaction(e.clientX, e.clientY, 'üîô');
            });
            window.addEventListener('click',function(e){ if(e.target===popup) popup.classList.remove('show'); });
            gtag('event','page_view',{'page_title':'Daily Wallpaper Cup','page_location':'https://wallrank.club','send_to':'G-19RP0D764T'});
            function checkDateChange() { const newTodayKey = getTodayKey(); if (newTodayKey !== todayKey) location.reload(); }
            setInterval(checkDateChange,60000);
            setTimeout(()=>updateGoldenLeader(),50);
            
            // ========== PUZZLE MAGIC ‚Äì COMPLETELY FIXED & EASY! ==========
            const overlay = document.getElementById('puzzleOverlay');
            const puzzleBtn = document.getElementById('openPuzzleBtn');
            const closePuzzleBtn = document.getElementById('closePuzzleBtn');
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const puzzleSelector = document.getElementById('puzzleSelector');
            const puzzleGridContainer = document.getElementById('puzzleGridContainer');
            const selectedTitle = document.getElementById('selectedTitle');
            const shuffleBtn = document.getElementById('shuffleBtn');
            const celebrationMsg = document.getElementById('celebrationMessage');
            const afterCelebration = document.getElementById('afterCelebration');
            const saveMemoryBtn = document.getElementById('saveMemoryBtn');
            const tellOthersBtn = document.getElementById('tellOthersBtn');
            const saveOptions = document.getElementById('saveOptions');
            const shareOptions = document.getElementById('shareOptions');
            const saveWithNameBtn = document.getElementById('saveWithNameBtn');
            const saveSimpleBtn = document.getElementById('saveSimpleBtn');
            const nameInputArea = document.getElementById('nameInputArea');
            const userName = document.getElementById('userName');
            const generateSigned = document.getElementById('generateSignedWallpaper');
            const closeShareBtn = document.getElementById('closeShareBtn');
            const shareLink = document.getElementById('shareLink');
            
            let selectedWallpaper = null;
            let currentOrder = [];
            let puzzleSolved = false;
            let celebrationTimer;

            function initPuzzleSelector() {
                puzzleSelector.innerHTML = '';
                wallpapers.forEach(wp => {
                    const thumb = document.createElement('div');
                    thumb.className = 'puzzle-thumb';
                    thumb.dataset.id = wp.id;
                    thumb.innerHTML = `<img src="${wp.filename}" alt="${wp.title}">`;
                    thumb.addEventListener('click', (e) => {
                        selectedWallpaper = wp;
                        selectedTitle.innerText = wp.title;
                        step1.style.display = 'none';
                        step2.style.display = 'block';
                        step3.style.display = 'none';
                        saveOptions.style.display = 'none';
                        shareOptions.style.display = 'none';
                        initPuzzle(wp);
                        createReaction(e.clientX, e.clientY, 'üß©');
                    });
                    puzzleSelector.appendChild(thumb);
                });
            }
            
            function initPuzzle(wp) {
                puzzleSolved = false;
                clearTimeout(celebrationTimer);
                afterCelebration.style.display = 'none';
                // show close button again (in case it was hidden)
                closePuzzleBtn.style.display = 'inline-block';
                currentOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                currentOrder = shuffleArray(currentOrder);
                renderPuzzleGrid(wp);
            }
            
            function shuffleArray(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }
            
            function renderPuzzleGrid(wp) {
                puzzleGridContainer.innerHTML = '';
                
                for (let i = 0; i < 9; i++) {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.draggable = true;
                    piece.dataset.pieceIndex = i;
                    
                    const pieceId = currentOrder[i];
                    const row = Math.floor(pieceId / 3);
                    const col = pieceId % 3;
                    
                    piece.style.backgroundImage = `url('${wp.filename}')`;
                    piece.style.backgroundSize = '360px 360px';
                    piece.style.backgroundPosition = `-${col * 120}px -${row * 120}px`;
                    
                    piece.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', e.target.dataset.pieceIndex);
                    });
                    
                    piece.addEventListener('dragover', (e) => e.preventDefault());
                    
                    piece.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const fromIdx = parseInt(e.dataTransfer.getData('text/plain'));
                        const toIdx = parseInt(e.target.dataset.pieceIndex);
                        
                        if (fromIdx === toIdx) return;
                        
                        [currentOrder[fromIdx], currentOrder[toIdx]] = [currentOrder[toIdx], currentOrder[fromIdx]];
                        renderPuzzleGrid(wp);
                        checkVictory(wp);
                    });
                    
                    puzzleGridContainer.appendChild(piece);
                }
            }
            
            function checkVictory(wp) {
                let win = true;
                for (let i = 0; i < 9; i++) {
                    if (currentOrder[i] !== i) { win = false; break; }
                }
                
                if (win && !puzzleSolved) {
                    puzzleSolved = true;
                    step2.style.display = 'none';
                    step3.style.display = 'block';
                    celebrationMsg.innerText = 'üéâ‚ú® PERFECT! ‚ú®üéâ';
                    afterCelebration.style.display = 'none';
                    
                    // üéä HIDE CLOSE BUTTON during celebration (so user doesn't miss the save/share)
                    closePuzzleBtn.style.display = 'none';
                    
                    // add confetti explosion
                    addConfetti();
                    
                    // 8 second celebration ‚Äì then show save/share buttons AND bring back close button
                    celebrationTimer = setTimeout(() => {
                        afterCelebration.style.display = 'block';
                        closePuzzleBtn.style.display = 'inline-block'; // close button reappears
                    }, 8000);
                }
            }
            
            shuffleBtn.addEventListener('click', (e) => {
                if (selectedWallpaper) {
                    currentOrder = shuffleArray([0, 1, 2, 3, 4, 5, 6, 7, 8]);
                    renderPuzzleGrid(selectedWallpaper);
                    createReaction(e.clientX, e.clientY, 'üîÑ');
                }
            });
            
            puzzleBtn.addEventListener('click', (e) => {
                overlay.classList.add('active');
                step1.style.display = 'block';
                step2.style.display = 'none';
                step3.style.display = 'none';
                saveOptions.style.display = 'none';
                shareOptions.style.display = 'none';
                initPuzzleSelector();
                createReaction(e.clientX, e.clientY, 'üß©‚ú®');
            });
            
            closePuzzleBtn.addEventListener('click', (e) => {
                overlay.classList.remove('active');
                clearTimeout(celebrationTimer);
                createReaction(e.clientX, e.clientY, 'üîö');
            });
            
            saveMemoryBtn.addEventListener('click', (e) => {
                step3.style.display = 'none';
                saveOptions.style.display = 'block';
                createReaction(e.clientX, e.clientY, 'üíæ‚ù§Ô∏è');
            });
            
            tellOthersBtn.addEventListener('click', (e) => {
                step3.style.display = 'none';
                shareOptions.style.display = 'block';
                shareLink.innerText = `https://wallrank.club/puzzle/${selectedWallpaper?.id || 'daily'}?win=1`;
                createReaction(e.clientX, e.clientY, 'üì¢');
            });
            
            saveSimpleBtn.addEventListener('click', (e) => {
                const link = document.createElement('a');
                link.href = selectedWallpaper.filename;
                link.download = `wallrank-${selectedWallpaper.title.replace(/[^a-z0-9]/gi,'-')}.jpg`;
                link.click();
                saveOptions.style.display = 'none';
                step1.style.display = 'block';
                createReaction(e.clientX, e.clientY, '‚¨áÔ∏èüéâ');
            });
            
            saveWithNameBtn.addEventListener('click', (e) => {
                nameInputArea.style.display = 'block';
                createReaction(e.clientX, e.clientY, 'üñãÔ∏è');
            });
            
            generateSigned.addEventListener('click', (e) => {
                const name = userName.value.trim() || 'puzzle master';
                const canvas = document.getElementById('signatureCanvas');
                canvas.width = 600; canvas.height = 480;
                const ctx = canvas.getContext('2d');
                const img = new Image(); img.crossOrigin = 'anonymous'; img.src = selectedWallpaper.filename;
                img.onload = () => {
                    ctx.drawImage(img, 0, 0, 600, 480);
                    ctx.font = 'bold 36px Quicksand, cursive'; ctx.fillStyle = 'white'; ctx.shadowColor = 'black'; ctx.shadowBlur = 12;
                    ctx.fillText(`üß© SOLVED BY ${name}`, 50, 420);
                    const link = document.createElement('a'); link.download = `solved-by-${name}.png`; link.href = canvas.toDataURL('image/png'); link.click();
                    nameInputArea.style.display = 'none'; saveOptions.style.display = 'none'; step1.style.display = 'block'; userName.value = '';
                    createReaction(e.clientX, e.clientY, '‚úÖüñºÔ∏è');
                };
            });
            
            // Social sharing with happy reactions
            document.querySelectorAll('.social-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    const platform = e.currentTarget.dataset.share;
                    const url = encodeURIComponent(shareLink.innerText);
                    let shareUrl = '';
                    let emoji = 'üîó';
                    if (platform === 'fb') { shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`; emoji = 'üìò'; }
                    else if (platform === 'tw') { shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=I solved the wallpaper puzzle!`; emoji = 'üê¶'; }
                    else if (platform === 'pin') { shareUrl = `https://pinterest.com/pin/create/button/?url=${url}`; emoji = 'üìå'; }
                    else if (platform === 'ig') { alert('üì∑ Share on Instagram ‚Äì take a screenshot!'); emoji = 'üì∑'; return; }
                    else if (platform === 'snap') { alert('üëª Snapchat ‚Äì screenshot & share!'); emoji = 'üëª'; return; }
                    else if (platform === 'email') { shareUrl = `mailto:?subject=Wallpaper puzzle&body=${url}`; emoji = 'üìß'; }
                    if (shareUrl) window.open(shareUrl, '_blank');
                    createReaction(e.clientX, e.clientY, emoji);
                    gtag('event', 'share_puzzle', { 'event_category': 'social', 'event_label': platform });
                });
            });
            
            closeShareBtn.addEventListener('click', (e) => {
                shareOptions.style.display = 'none';
                step1.style.display = 'block';
                createReaction(e.clientX, e.clientY, 'üîô');
            });
        })();
    </script>
    <div style="display:none;">daily wallpaper vote puzzle 4K free AI winner every midnight UTC+0 wallrank.club</div>
</body>
</html>
